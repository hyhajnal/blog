## Nodejs 线程和锁

Nodejs是多线程的。nodejs启动后会创建V8实例，有多个线程。

但是是单线程执行的（执行代码都在一个主线程中，然后通过事件循环分给其他线程执行，再拿到回调）



#### 并发安全问题

比如操作同一份数据的时候 ？

1. ##### 异步代码中的并发（单进程）

nodejs中同一个事件循环中的执行是可以保证并发顺序的。但通常业务代码会包含多个异步操作，就会在多个事件循环中被执行，这个时候操作同一份数据会和预期的不一致

解决方式：加锁（async-lock）

2. ##### 多进程

单进程无法利用CPU多核性能，所以一般使用cluster模块开启多个node进程。

解决方式：分布式锁

