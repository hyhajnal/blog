## èµ„æºé¢„åŠ è½½

[quicklink](https://juejin.im/post/5c21f8435188256d12597789) æ˜¯ä¸€ä¸ªé€šè¿‡é¢„åŠ è½½èµ„æºæ¥æå‡åç»­é€Ÿåº¦çš„è½»é‡çº§å·¥å…·åº“

#### **å¦‚ä½•å»é¢„åŠ è½½ä¸€ä¸ªèµ„æº**ï¼Ÿ

ç¬¬ä¸€ç§ï¼šprefetchä¸preload

```js
<link rel="prefetch" href="xxx.js" as="script">
```

ç¬¬äºŒç§ï¼šXHR åˆ©ç”¨æµè§ˆå™¨è‡ªèº«çš„ç¼“å­˜ï¼ˆç”±äºæµè§ˆå™¨çš„å·®å¼‚ï¼ŒXHRçš„æˆåŠŸç‡æ›´é«˜ï¼‰

ç¬¬ä¸‰ç§ï¼šæ ‡ç­¾



#### èµ„æºçš„ä¼˜å…ˆçº§

* html+css+font
* preloadã€scriptã€xhr
* å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ï¼ˆå›¾ç‰‡èµ„æºä¼šæ ¹æ®å›¾ç‰‡æ˜¯å¦åœ¨å¯è§è§†å›¾ä¹‹å†…æ¥æ”¹å˜ä¼˜å…ˆçº§ï¼‰
* prefetchï¼ˆæ¯”è¾ƒè€çš„å±æ€§ï¼Œå…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼‰



#### é¢„åŠ è½½çš„ç­–ç•¥ï¼Ÿ

åœ¨å¯è§†åŒºæ‰å»åŠ è½½



#### **èµ„æºçš„ç¼“å­˜**

* LocalStorageï¼ˆå¯ä»¥ç¼“å­˜jsï¼‰



#### ä¸¾ä¸€ä¸ªå®é™…çš„ ğŸŒ°

ç¬¬ä¸€å±æœ‰ä¸€ä¸ªloadingåŠ¨ç”»ï¼Œç¬¬äºŒå±æœ‰ä¸€ä¸ªä½¿ç”¨ [jsmpeg](https://github.com/phoboslab/jsmpeg/issues/256)ï¼ˆcanvasç»˜åˆ¶tsæ ¼å¼ï¼‰çš„è§†é¢‘ï¼Œæƒ³è¦é¢„åŠ è½½

è§†é¢‘æ ¼å¼

- TS & FLV & MP4
  - TS ç‰¹ç‚¹æ˜¯ä»è§†é¢‘æµçš„ä»»ä¸€ç‰‡æ®µå¼€å§‹éƒ½æ˜¯å¯ä»¥ç‹¬ç«‹è§£ç çš„ï¼Œæ¯”mp4å¤§10%å·¦å³ã€‚ä¸€èˆ¬è§†é¢‘è¿‡å¤§æ—¶å¯ç”¨ä½œåˆ†ç‰‡è¯·æ±‚

è§†é¢‘ç¼–ç 

* H.264 & H.265

  * H.265å‹ç¼©æ•ˆç‡æ›´é«˜ï¼Œä¼ è¾“ç ç‡æ›´ä½ï¼Œè§†é¢‘ç”»è´¨æ›´ä¼˜
    
  * H.264æ”¯æŒçš„æœºå‹èŒƒå›´æ›´




#### æ¥ä¸‹æ¥å¼€å§‹æˆ‘ä»¬çš„å®éªŒ.....

##### ç¬¬ä¸€ç§æ˜¯videoæ ‡ç­¾

```
<video preload width="1" height="1" controls src="./static/videos/1.mp4"></video> 
```
å› ä¸ºjsmpegå†…éƒ¨æ˜¯å‘èµ·äº†ä¸€ä¸ªxhrè¯·æ±‚ï¼Œå¦‚æœæ˜¯ç”¨videoåšé¢„åŠ è½½ï¼Œtypeä¸ä¸€è‡´
<img src="assets/image-20200301170143423.png" alt="image-20200301170143423" style="zoom:50%;" />





##### ç¬¬äºŒç§æ˜¯xhr

å¼€å§‹æ²¡æœ‰æŒ‡å®š `responseType` ä¼šæœ‰è·¨åŸŸé—®é¢˜ï¼Œåæ¥æˆ‘æŠŠjsmpegå†…éƒ¨çš„xhræ‹·äº†ä¸€ä»½æ²¡æœ‰è·¨åŸŸ

```js
// xhr è¯·æ±‚ï¼ˆè™½ç„¶è¯·æ±‚ä¸€è‡´ï¼Œå®æµ‹ä¹Ÿæ˜¯å‘èµ·äº†ä¸¤ä¸ªè¯·æ±‚ï¼‰
export function preloadVideo(url) {
    return new Promise((resolve) => {
        let request = new XMLHttpRequest();

        request.onreadystatechange = function() {
            if (
                request.readyState === request.DONE && 
                request.status === 200
            ) {
                resolve();
            }
        }.bind(this);

        request.open('GET', url);
        request.responseType = "arraybuffer";
        request.send();
    });
}
```

<img src="assets/image-20200301205031218.png" alt="image-20200301205031218" style="zoom:50%;" />



##### ç¬¬ä¸‰ç§çš„ link preload

æ³¨æ„å¿…é¡»è¦æŒ‡å®šasï¼Œå¦åˆ™è¯·æ±‚æ— æ³•æˆåŠŸ

```js
// linkï¼ˆå‘èµ·ä¸¤ä¸ªè¯·æ±‚ï¼Œtypeä¸ä¸€æ ·ï¼‰
export function preloadVideo(url) {
    return new Promise((resolve) => {
        const link = document.createElement(`link`);
        const isSupportPrefetch = (link.relList || {}).supports && link.relList.supports('prefetch');
        const isSupportPreload = (link.relList || {}).supports && link.relList.supports('preload');

        if (!isSupportPrefetch && !isSupportPreload) {
            return resolve('fail');
        }

        link.rel = isSupportPreload ? 'preload' : 'prefetch';
        link.href = url;
        link.as = "fetch";
        link.crossorigin = true;
        console.log(link);
        document.head.appendChild(link);
        link.onload = () => {
            console.log('åŠ è½½å®Œæ¯•');
            resolve('success');
        };
    });
}
```

<img src="assets/image-20200301205126251.png" alt="image-20200301205126251" style="zoom:50%;" />



##### å‘ç°è¿™æ ·ä¸€åœˆè¯•ä¸‹æ¥ï¼Œæ²¡ä»€ä¹ˆæ•ˆæœã€‚ã€‚

æœ€åå‘ç°jsmpegå…¶å®å°±æœ‰ä¸€ä¸ªonloadäº‹ä»¶ï¼Œæ‰€ä»¥å°±æ˜¯åŠ è½½æ—¶ç”¨å›¾ç‰‡ç›–åœ¨canvasä¸Šï¼ŒåŠ è½½å®Œæˆå†éšè—å›¾ç‰‡

<img src="assets/image-20200301203734995.png" alt="image-20200301203734995" style="zoom:50%;" />



#### å‚è€ƒæ–‡ç« 

[quicklink çš„å®ç°åŸç†ä¸ç»™å‰ç«¯çš„å¯å‘](https://juejin.im/post/5c21f8435188256d12597789)

[çŸ­è§†é¢‘å®è´=æ…¢ï¼Ÿé˜¿é‡Œå·´å·´å·¥ç¨‹å¸ˆè¿™æ ·ç§’å¼€çŸ­è§†é¢‘](https://yq.aliyun.com/articles/680859?utm_content=g_1000032362)

[æµè§ˆå™¨é¡µé¢èµ„æºåŠ è½½è¿‡ç¨‹ä¸ä¼˜åŒ–](https://juejin.im/post/5a4ed917f265da3e317df515)

[cssåŠ è½½ä¼šé€ æˆé˜»å¡å—](https://juejin.im/post/5b88ddca6fb9a019c7717096)